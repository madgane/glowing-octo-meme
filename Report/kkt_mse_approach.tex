
In general, the distributed approaches presented in the earlier sections can be used to design the precoders in a decentralized way. The main issue affecting the convergence of the algorithm in both \acl{PD} and \ac{ADMM} apporaches is the update of the coupling variables using the step size. In order to avoid the use of subgradient update, the \ac{MSE} reformulation method is considered is studied extensively in the literature, such as, \cite{wmmse_shi} for the \ac{WSRM} problem and \cite{kaleva2012weighted} considered the \ac{WSRM} problem with the additional \ac{QoS} constraints like minimum guaranteed rate requirements.

When the queues are involved, the maximum rate constraint imposed by the number of queued packets at the \ac{BS} poses a nonconvex constraint, which makes the problem difficult to solve in an iterative approach. But, in the current method, the rate constraints imposed by the number of queued packets are implicitly present in the objective function, it eliminates the need of an additional rate constraints. The current formulation uses the \ac{MSE} approach to obtain the iterative algorithm for special scenarios due to the absolute operator in the objective function. Since the absolute of a function is not differentiable, the problem is usually solved by the subgradient approach. In order to solve the problem using the closed form equations, we drop the absolute value operator in the objective to obtain the differentiable equivalent. It is valid for the following two special cases, namely,
\begin{itemize}
\item when the exponent \me{q} is even or,
\item when the number of backlogged packets for each user is larger than the available resources for the transmission \me{Q_k \gg \sum_{n=1}^N \sum_{l=1}^L {t}_{l,k,n}}.
\end{itemize}
The first condition is required for the iterative design, since the objective function needs to be differentiable to find the \ac{KKT} equations. So, when the exponent \me{q} is even, the absolute operator can be dropped from the objective function without any change in the optimal solution for any number of queued packets.

By removing the absolute value operator from \eqref{eqn-mse-2}, the problem can be rewritten as
\begin{IEEEeqnarray}{rCl}\label{kkt-mse-1}
\underset{\substack{t_{l,k,n},\mvec{M}{k,n}, \alpha_{l,k,n}, \\ \delta_{b},\sigma_{l,k,n},\mvec{W}{k,n}}}{\text{minimize}} &\hspace{0.5cm}& \sum_{b \in \mc{B}} \sum_{k \in \mc{U}_b} \, a_k \, \left ( Q_k - \sum_{n = 1}^N \sum_{l = 1}^{L} t_{l,k,n} \right )^q \IEEEyessubnumber \label{kkt-mse-1.1} \\
\text{subject to} & \hspace{0.5cm} & \nonumber \\
\alpha_{l,k,n} : & \hspace{0.5cm} & \epsilon_{l,k,n} = \left | 1 - \mvec{w}{l,k,n}^\herm \mvec{H}{b_k,k,n} \mvec{m}{l,k,n} \right |^2 + \sum_{(x,y) \neq (l,k)} \left | \mvec{w}{l,k,n}^\herm \mvec{H}{b_y,y,n} \mvec{m}{x,y,n} \right |^2 \\ \nonumber
&\hspace{0.5cm}& \quad {} + N_0 \, \|\mvec{w}{l,k,n}\|^2 \IEEEyessubnumber \label{kkt-mse-1.2} \\
\sigma_{l,k,n} : & \hspace{0.5cm} & - \log(\tilde{\epsilon}_{l,k,n}) - \frac{\left ( {\epsilon}_{l,k,n} - \tilde{\epsilon}_{l,k,n} \right ) }{\tilde{\epsilon}_{l,k,n}} \geq t_{l,k,n} \, \log(2) \IEEEyessubnumber \label{kkt-mse-1.3} \\
\delta_b : & \hspace{0.5cm} & \sum_{n = 1}^N \sum_{k \in \mathcal{U}_b} \text{tr} \, (\mvec{M}{k,n} \mvec{M}{k,n}^\herm) \leq P_{{\max}}, \fall b, \IEEEyessubnumber \label{kkt-mse-1.4}
\end{IEEEeqnarray}
where \me{\alpha_{l,k,n},\sigma_{l,k,n}} and \me{\delta_b} are the dual variables corresponding to the constraints defined in \eqref{kkt-mse-1.2}, \eqref{kkt-mse-1.3} and \eqref{kkt-mse-1.4}. The equality condition is used for \eqref{kkt-mse-1.2} and \eqref{kkt-mse-1.3}, since the variables \me{\epsilon_{l,k,n}} and \me{t_{l,k,n}} are used for the corresponding expressions on the other side.

Now the Lagrangian of the problem expressed in \eqref{kkt-mse-1}, with the corresponding dual variables, is used obtain the \ac{KKT} expressions by partially differentiating with respect to the primal variables \me{t_{l,k,n}}, \me{\epsilon_{l,k,n}}, \me{m_{l,k,n}}, \me{w_{l,k,n}} and the dual variables \me{\alpha_{l,k,n},\sigma_{l,k,n}} and \me{\delta_b}. Since the precoder design is solved in an iterative fashion, the superscript \me{(i)} denotes the iteration instants. The detailed \ac{KKT} expressions are provided in the  Appendix \ref{a-1}. Upon solving the \ac{KKT} expressions, we obtain the following iterative solution as
\begin{IEEEeqnarray}{rCl} \label{kkt-mse-4}
\mvec{m}{l,k,n}^{(i)} &=& \left ( \sum_{x \in \mc{U}} \sum_{y=1}^L \alpha_{y,x,n}^{(i-1)} \mvec{H}{b_k,x,n}^\herm \mvec{w}{y,x,n}^{(i-1)} \mvec{w}{y,x,n}^{\herm \, {(i-1)}} \mvec{H}{b_k,x,n} + \delta_b \mbf{I}_{N_T} \right )^{-1} \alpha^{(i-1)}_{l,k,n} \mvec{H}{b_k,k,n}^\herm \mvec{w}{l,k,n}^{(i-1)} \IEEEyessubnumber \label{kkt-mse-4.3} \\
\mvec{w}{l,k,n}^{(i)} &=& \left ( \sum_{x\in\mc{U}}\sum_{y=1}^L \mvec{H}{b_x,k,n} \mvec{m}{y,x,n}^{(i)} \mvec{m}{y,x,n}^{\herm \, (i)} \mvec{H}{b_{x},k,n}^\herm + \mathbf{I}_{N_R} \right ) ^{-1} \; \mvec{H}{b_k,k,n} \; \mvec{m}{l,k,n}^{(i)}, \IEEEyessubnumber \label{kkt-mse-4.6} \\
\epsilon_{l,k,n}^{(i)} &=& \left | 1 - \mvec{w}{l,k,n}^{\herm \, (i)} \mvec{H}{b_k,k,n} \mvec{m}{l,k,n}^{(i)} \right |^2 + \sum_{(x,y) \neq (l,k)} \left | \mvec{w}{l,k,n}^{\mathrm{H} \, (i)} \mvec{H}{b_y,y,n} \mvec{m}{x,y,n}^{(i)} \right |^2 + N_0 \, \|\mvec{w}{l,k,n}^{(i)}\|^2, \IEEEyessubnumber \label{kkt-mse-4.4} \\
t_{l,k,n}^{(i)} &=&  -\log_2(\epsilon_{l,k,n}^{(i-1)}) - \frac{\left ( \epsilon_{l,k,n}^{(i)} - \epsilon_{l,k,n}^{(i-1)} \right ) }{\log(2) \, \epsilon_{l,k,n}^{(i-1)}}, \IEEEyessubnumber \label{kkt-mse-4.5} \\
\sigma_{l,k,n}^{(i)} &=& q \,a_k \, \log_2(e)  \, \left (Q_k - \sum_{n = 1}^N \sum_{l=1}^L t_{l,k,n}^{(i)} \right )^{(q-1)}, \IEEEyessubnumber \label{kkt-mse-4.2} \\
\alpha^{(i)}_{l,k,n} &=& \alpha^{(i-1)}_{l,k,n} + \rho \left ( \frac{\sigma_{l,k,n}^{(i)}}{\epsilon_{l,k,n}^{(i)}} - \alpha^{(i-1)}_{l,k,n} \right ), \IEEEyessubnumber \label{kkt-mse-4.1}
\end{IEEEeqnarray}
\me{\forall k \in \mc{U}}, \me{\forall n \in \set{1,\ldots,N}} and \me{\forall l \in \set{1,\ldots,L}}. The dual variable \me{\alpha^{(i)}} is updated with the memory to avoid any oscillations due to the over allocation of the resources. The step size \me{\rho} is used to reduce the effect on the precoder designs on the excess allocations.

The \ac{KKT} solutions provided in \eqref{kkt-mse-4} are solved in an iterative manner by initializing the transmit and the receive precoders \me{\mvec{M}{k,n},\mvec{W}{k,n}} with the single user beamforming and the \ac{MMSE} vectors. The dual variable \me{\alpha}'s corresponding to precoder weights are initialized with ones to provide equal priorities to all streams. With the initial values, the closed form solutions mentioned in \eqref{kkt-mse-4} are evaluated sequentially until convergence or to certain accuracy. In \eqref{kkt-mse-4}, all expressions are provided in a closed form except the transmit precoders \eqref{kkt-mse-4.3}, which depends on the \ac{BS} specific dual variable \me{\delta_b}. It can be solved efficiently by the bisection method satisfying the power constraint \eqref{kkt-mse-1.4}. After each iteration instant, the transmit and the receive precoders are exchanged across the coordinating \acp{BS} in \me{\mc{B}} to obtain the next operating point.

The receive beamformers from the users can be informed to the coordinating \acp{BS} by using the precoded uplink pilot signaling, where the precoders used for the uplink pilots are the receive beamformers \me{\mvec{W}{k,n}} evaluated at the receivers. Upon receiving the uplink precoded pilots by the \ac{BS}, the effective channel \me{\mvec{W}{k,n}^{\herm \, (i-1)} \mvec{H}{b,k,n}} can be used in the expression \eqref{kkt-mse-4.3} to update the transmit precoders at the respective \acp{BS} \cite{komulainen2013effective}. The algorithmic representation of the \ac{KKT} based scheme is shown in Algorithm. \ref{algo-4}.
\begin{algorithm}
 \SetAlgoLined
 \DontPrintSemicolon
 \BlankLine
 \SetKwInput{KwInit}{Initialize}
 \KwIn{\me{a_k, \, Q_k, \, \mvec{H}{b,k,n},\; \fall b \in \mathcal{B}, \, \fall k \in \mathcal{U}, \fall n \in \mathcal{C}}}
 \KwOut{\me{\mvec{m}{l,k,n}} and \me{\mvec{w}{l,k,n} \fall l \in \set{1,2,\dotsc,L}}}
 \KwInit{\me{i=1} and the transmit precoders \me{\mbf{m}^{(0)}_{l,k,n}} randomly satisfying the power constraint \eqref{kkt-mse-1.4}}
 \KwInit{\me{\epsilon_{l,k,n}^{(0)}} randomly, \me{\mvec{w}{l,k,n}^{(0)}} with \eqref{kkt-mse-4.6} and \me{{t}_{l,k,n}^{(0)}} using \eqref{kkt-mse-4.5}}
 set the maximum iteration counter \me{I_{\max}} to a valid number \;
 for each \ac{BS} \me{b \in \mc{B}}, perform the following procedure \;
 \Repeat{convergence or \me{i \geq I_{\max}}}{
	solve for the dual variables \me{\alpha_{l,k,n}^{(i)}} and \me{\sigma_{l,k,n}^{(i)}} using \eqref{kkt-mse-4.1} and \eqref{kkt-mse-4.2} \;
	update the transmit precoders \me{\mvec{M}{k,n}^{(i)}} with \me{\delta_b} using \eqref{kkt-mse-4.3} by the bisection method satisfying \eqref{kkt-mse-1.4} \;
	update the \ac{MSE} variable \me{\epsilon_{l,k,n}^{(i)}} and the throughput variable \me{t_{l,k,n}^{(i)}} using \eqref{kkt-mse-4.4} and \eqref{kkt-mse-4.5} \;
	evaluate the receive beamforming vector \me{\mvec{W}{k,n}} by \eqref{kkt-mse-4.6} \;
	exchange the transmit and the receive precoders \me{\mvec{M}{k,n}^{(i)}, \mvec{W}{k,n}^{(i)}} across the coordinating \acp{BS} in \me{\mc{B}} \;
	$i = i + 1$ \;
  }
 \caption{\ac{KKT} approach for the \ac{JSFRA} scheme}
  \label{algo-4}
\end{algorithm}
